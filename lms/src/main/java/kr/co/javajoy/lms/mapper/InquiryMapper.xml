<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.javajoy.lms.mapper.InquiryMapper">
 <select id="selectInquiryByPage"
 		 parameterType="java.util.Map"
 		 resultType="java.util.Map">
 SELECT 
 	b.board_no boardNo
   ,b.member_id memberId
   ,t.teacher_name teacherName
   ,s.student_name studentName
   ,b.board_title boardTitle
   ,b.private_no privateNo
   ,b.create_date createDate
   ,b.update_date updateDate
FROM board b
LEFT JOIN teacher t
	   ON t.member_id = b.member_id
LEFT JOIN student s
	   ON s.member_id = b.member_id
WHERE board_category = "3"
ORDER BY create_date desc
LIMIT #{beginRow} , #{rowPerPage}
 </select>
 <select id="selectInquiryTotalCount"
 		resultType="int">
 SELECT
 	COUNT(*) cnt
 FROM board
 WHERE board_category = "3"
 </select>
 <select id="selectTeacherListBySubject"
	 		 parameterType="String"
	 		 resultType="java.util.Map">
	SELECT
		   c.member_id memberId
		  ,t.teacher_name teacherName
      FROM subject_student ss
INNER JOIN curriculum c
		ON c.subject_no = ss.subject_no
INNER JOIN teacher t
		ON t.member_id =c.member_id
	 WHERE ss.member_id = #{memberId}
 GROUP BY  c.member_id
</select>
<insert id="insertInquiry"
		parameterType="kr.co.javajoy.lms.vo.Board">
	<selectKey resultType="int" keyProperty="boardNo" order="AFTER">
		select last_insert_id()
	</selectKey>
	INSERT INTO board(
			member_id
		   ,board_category
		   ,board_title
		   ,board_content
		   ,private_no
		   ,create_date
		   ,update_date
	) VALUES (
			#{memberId}
		   ,"3"
		   ,#{boardTitle}
		   ,#{boardContent}
		   ,#{privateNo}
		   ,NOW()
		   ,NOW()
		)
</insert>
<insert id="insertBoardFile"
		parameterType="kr.co.javajoy.lms.vo.Boardfile">
	INSERT INTO board_file(
			    board_no
			   ,board_file_original_name
			   ,board_file_name
			   ,board_file_type
			   ,board_file_size
			   ,create_date
			   ,update_date
		) VALUES (
				#{boardNo}
			   ,#{boardFileOriginalName}
			   ,#{boardFileName}
			   ,#{boardFileType}
			   ,#{boardFileSize}
			   ,NOW()
			   ,NOW()
		)
</insert>
<insert id="insertReceiver"
		parameterType="kr.co.javajoy.lms.vo.Receiver">
	INSERT INTO receiver (
				board_no
			   ,receiver
			   ,update_date
		) VALUES (
				#{boardNo}
			   ,#{receiver}
			   ,NOW()
		)
</insert>
<select id="selectInquiryBoardOne"
		parameterType="int"
		resultType="java.util.Map">
SELECT
	b.board_no boardNo
   ,b.member_id memberId
   ,t.teacher_name teacherName
   ,s.student_name studentName
   ,b.board_title boardTitle
   ,b.board_content boardContent
   ,b.private_no privateNo
   ,b.create_date createDate
   ,b.update_date updateDate
	 FROM board b
LEFT JOIN teacher t
       ON t.member_id = b.member_id
LEFT JOIN student s
       ON s.member_id = b.member_id
    WHERE board_no = #{boardNo} 
</select>
<select id="selectInquiryBoardfileOne"
		parameterType="int"
		resultType="kr.co.javajoy.lms.vo.Boardfile">
SELECT
	board_file_no boardFileNo
   ,board_no boardNo
   ,board_file_original_name boardFileOriginalName
   ,board_file_name boardFileName
   ,board_file_type boardFileType
   ,board_file_size boardFileSize
   ,create_date createDate
   ,update_date updateDate
FROM board_file
WHERE board_no = #{boardNo}			
</select>
<select id="selectInquiryComment"
		parameterType="int"
		resultType="kr.co.javajoy.lms.vo.BoardComment">
SELECT
	board_comment_no boardCommentNo
   ,member_id memberId
   ,board_no boardNo
   ,board_comment_content boardCommentContent
   ,create_date createDate
   ,update_date updateDate
FROM board_comment
WHERE board_no = #{boardNo}
</select>
<select id="selectBoardCountByBoardNo"
		parameterType="int"
		resultType="int">
SELECT
	COUNT(*)
FROM board_file
WHERE board_no = #{boardNo}
</select>
</mapper>